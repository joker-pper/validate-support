(function(d){d.fn.validateSupport=function(l){return h(d(this),l)};d.fn.validateSupport.defaults={language:{required:"此项不能为空",pattern:"正则验证失败",success:"验证通过",conditional:"自定义函数验证失败",number:"必须是数字",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",digits:"只能输入整数",maxlength:"请输入一个长度最多是 {val} 的字符串",minlength:"请输入一个长度最少是 {val} 的字符串",max:"请输入一个最大是 {val} 的数字",min:"请输入一个最小是 {val} 的数字",idcard:"请输入合法的身份证号",phone:"请输入正确的电话",date:"请输入有效的日期",equalTo:"请输入相同的值",dateISO:"请输入有效的日期 (YYYY-MM-DD)",range:"请输入范围在 {0} 到 {1} 之间的数值"},api:{number:function(l){return d.isNumeric(l)},isBlank:function(l){return d.trim(l)==""},isEmpty:function(l){return l==null||l==""},min:function(m,l){return d.trim(m)>=l},max:function(m,l){return d.trim(m)<=l},utf8Length:function(m){var l=0;for(var p=0;p<m.length;p++){var o=m.charCodeAt(p);if(o<128){l++}else{if((o>127)&&(o<2048)){l=l+2}else{l=l+3}}}return l},email:function(l){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(l)},digits:function(l){return/^\d+$/.test(l)},idcard:function(l){return/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(l)},phone:function(l){return(/^((00|\+)?(86(?:-| )))?((\d{11})|(\d{3}[- ]{1}\d{4}[- ]{1}\d{4})|((\d{2,4}[- ]){1}(\d{7,8}|(\d{3,4}[- ]{1}\d{4}))([- ]{1}\d{1,4})?))$/).test(l)},url:function(l){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(l)},maxlength:function(l,n,m){return m>=this.currentlength(l,n)},minlength:function(l,n,m){return m<=this.currentlength(l,n)},currentlength:function(m,n){if(m.twoCharLinebreak){n=n.replace(/\r(?!\n)|\n(?!\r)/g,"\r\n")}else{n=n.replace(new RegExp("\r?\n","g"),"\n")}var l=0;if(m.utf8){l=this.utf8Length(n)}else{l=n.length}return l},date:function(l){l=l.replace(/-/g,"/");return !/Invalid|NaN/.test(new Date(l).toString())},dateISO:function(l){return/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(l)},range:function(l,m){return l>=m[0]&&l<=m[1]},equalTo:function(o,n,p,q){var l=q.$el;var m=p.$el;if(l.not(".validate-equalTo-blur").length){l.addClass("validate-equalTo-blur").on("blur.validate-equalTo",function(){m.trigger("change")})}return o===l.val()}}};var j={convertMessage:function(v,s){var o={};var t=["required","pattern","conditional","valid"];var u=this;for(var m in t){var r=t[m];var p=v[r];if(v&&p){var q=p.template,n=p.content;if(typeof q==="function"){q=q.call(p,s)}if(typeof n==="function"){n=n.call(p,s)}q=q||"";n=n||"";if(s){p.template=q;p.content=n}if(r=="conditional"){var l=function(x){var y;if(d(this).data("required")){y=x["required"]}else{y=x["conditional"]}var w=u.getDataConfirm(d(this))||y.content;w=u.parseContent(/{content}/,y.template,w);return w};o["conditional"]=function(){return l.call(this,v)}}else{n=this.parseContent(/{content}/,q,n);o[r]=n}}}return o},parseContent:function(m,l,n){return l.replace(m,n)},required:function(m,p,l,r){var q=false;var n=p["equalTo"];if(n!=null){var o=r[n.key];q=!i.isEmpty(this.getValue(o.$el,o));if(!q){q=this.required(o.$el,o,l,r)}}else{if(p.required!=null){if(typeof p.required=="boolean"){q=p.required}else{if(typeof p.required=="function"){q=p.required(m,p.key,p)}}}else{if(l!=null&&typeof l=="function"){q=l(m,p.key,p)}else{if(typeof l=="boolean"){q=l}}}}return q},setDataConfirm:function(l,m){l.data("data-confirm-content",m)},getDataConfirm:function(l){return l.data("data-confirm-content")},getValue:function(l,n){var m=l.val();if(n.trim&&l.attr("type")!=="password"){m=d.trim(m)}return m},getFunctionName:function(n){var p=n.split("-");var l="";for(var m in p){var o=p[m];if(m!=0){o=o.substring(0,1).toUpperCase()+o.substring(1)}l+=o}return l+"Confirm"},getKeys:function(l){if(l===undefined||l===null){return[]}else{if(Object&&Object.keys){return Object.keys(l)}else{if(typeof l==="object"){if(Array.isArray(l)){return[]}else{var n=[];for(var m in l){n.push(m)}return n}}}}}};var k=d.fn.validateSupport.defaults.api;var g=d.fn.validateSupport.defaults.language;var i={number:k.number,isBlank:k.isBlank,isEmpty:k.isEmpty,log:function(l){console&&console.log(l)},logError:function(l){console&&console.error(l)}};var f=k;var c=function(l){return g[l]};var e=function(s,x){var t=["number","url","email","digits","idcard","phone","date","dateISO"];var o=[];for(var p in t){var l=t[p];var v=s[l];if(v!==undefined){var r=typeof v;if(r!=="boolean"&&v!==1&&v!==0){throw new Error("rule key named "+s.key+"'s method "+l+" value must be boolean")}else{o.push(l)}}}var y=["min","max"];for(var p in y){var l=y[p];var v=s[l];if(v!==undefined){if(!i.number(v)){throw new Error("rule key named "+s.key+"'s method "+l+" value must be number")
}else{o.push(l)}}}var u=["maxlength","minlength"];for(var p in u){var l=u[p];var v=s[l];if(v!==undefined){var r=typeof v;if((r==="object"&&v!==null&&!Array.isArray(v))||r==="number"){var q={twoCharLinebreak:true,utf8:false,size:0};if(r==="number"){v={size:v}}d.extend(q,v);s[l]=q;o.push(l)}else{throw new Error("rule key named "+s.key+"'s method "+l+" value must be object or number")}}}l="range";var m=s[l];if(m!==undefined){if(!(Array.isArray(m)&&m.length===2)){throw new Error("rule key named "+s.key+"'s method "+l+" value must be array and length is two")}if(!(typeof m[0]==="number"&&typeof m[1]==="number")){throw new Error("rule key named "+s.key+"'s method "+l+" array value type must be number")}o.push(l)}l="equalTo";v=s[l];if(v!==undefined){var r=typeof v;if(r==="string"){v={key:v,error:c(l)}}else{if((r==="object"&&v!==null&&!Array.isArray(v))){v=d.extend({error:c(l)},v)}else{throw new Error("rule key named "+s.key+"'s method "+l+" value not allowed, it must be string or {key: string, error: string}")}}s[l]=v;var w=v.key;if(x[w]===undefined){throw new Error("rule key named "+s.key+"'s method "+l+" value must be in rule key")}o.push(l)}var z=-1;var n=false;for(var p in o){var l=o[p];if(l==="number"){z=parseInt(p)}else{if(l==="range"||l==="max"||l==="min"){n=true}}if(n&&z>-1){break}}if(n){s["number"]=true;if(z>-1){o.splice(z,1)}o.splice(0,0,"number")}s.methods=o};function b(o,m,n){var l;if(o==="equalTo"){l=m.error}else{l=c(o);if(l.indexOf("{")>=0){if(o==="max"||o==="min"){l=j.parseContent(/{val}/,l,m)}else{if(o==="maxlength"||o==="minlength"){l=j.parseContent(/{val}/,l,m.size)}else{if(o==="range"){l=j.parseContent("{0}",l,m[0]);l=j.parseContent("{1}",l,m[1])}}}}}return l}var a=function(o,n,m,p){function l(){var w=true;var z=o.$description;var C;var v=j.required(n,o,m,p);var x=d(this);var B=j.getValue(n,o);if(v==true){if(B!=null&&B.length>0){w=true}else{w=false}var y=d.trim(x.attr("type"));if(y!=""&&(y=="checkbox"||y=="radio")){w=d("[name='"+n.attr("name")+"']:checked").length>0}}else{if(i.isEmpty(B)){return w}}if(!w){C=o.message.required.content}z.data("required",!w);try{if(w){var s=o.methods;for(var t in s){var r=s[t];var A=o[r];if(r==="min"||r==="max"){w=f[r](B,A)}else{if(r==="maxlength"||r==="minlength"){w=f[r](A,B,A.size)}else{if(r==="range"){w=f[r](B,A)}else{if(r==="equalTo"){w=f[r](B,A,o,p[A.key])}else{w=f[r](B)}}}}if(!w){C=b(r,A,B);break}}}if(w){if(o.conditional!=null&&typeof o.conditional=="function"){var q=o.conditional(n,o.key,o,p);if(typeof q=="boolean"){w=q}else{if(typeof q=="object"){if(typeof q.status=="undefined"){throw new Error("the user conditional function's return json value is not allowed, it's keys must has status,"+"\n which name is "+o.key+" in the rules option.")}w=q.status;C=q.error}else{throw new Error("the user conditional function return value is not allowed, which name is "+key+" in the rules option.")}}if(i.isEmpty(C)){C=o.message.conditional.content}}}}catch(u){w=false;C=u;i.logError(u)}if(!w){j.setDataConfirm(z,C)}return w}return l};function h(v,r){var B={onKeyup:true,onBlur:true,onChange:true,sendForm:true,eachValidField:function(){d(this).parents(".form-group").removeClass("has-error").addClass("has-success")},eachInvalidField:function(){d(this).parents(".form-group").removeClass("has-success").addClass("has-error")},invalid:function(T,S){},valid:function(T,S){}};var m={debug:false,clearAll:function(U){for(var T in U){var S=U[T];S.$description.children().remove();S.$el.parents(".form-group").removeClass("has-success has-error")}},always:null,scrollToError:null,required:false,trim:false,description:null,descriptionPrefix:"validate",message:{required:{template:'<span class="help-block">{content}</span>',content:d.fn.validateSupport.defaults.language.required},pattern:{template:'<span class="help-block">{content}</span>',content:d.fn.validateSupport.defaults.language.pattern},conditional:{template:'<span class="help-block">{content}</span>',content:d.fn.validateSupport.defaults.language.conditional},valid:{template:'<span class="help-block">{content}</span>',content:d.fn.validateSupport.defaults.language.success}},rules:{}};var F=j.getKeys(m);for(var L in F){var R=F[L];var G=r[R];var s=typeof G;if(s!=="undefined"){if(R==="message"){for(var p in G){d.extend(m[R][p],G[p])}}else{m[R]=G}}delete r[R]}r=d.extend(B,r);var A=m.rules;r.conditional={};r.description={};var y=m.required;var q=m.trim;var M=[];if(A){for(var R in A){var w=A[R];w.key=R;var Q;var E=w.id;if(typeof E=="boolean"&&E){Q=d("#"+R)}else{var I=w.selector;if(I){var t=typeof I;if(t=="string"){Q=v.find(w.selector)}else{if(t=="function"){Q=I.call(v,v)}}}else{Q=v.find("[name='"+R+"']")}}var K=false;if(w.trim!=null){if(typeof w.trim=="boolean"){K=w.trim}}else{if(typeof q=="boolean"){K=q}}w.trim=K;if(w.mask){Q.data("mask",w.mask)}if(w.pattern){Q.data("pattern",w.pattern)}var z=(i.isEmpty(m.descriptionPrefix)?"":m.descriptionPrefix+"-")+R+"-description";Q.attr("data-description",R);Q.attr("data-describedby",z);var O=j.getFunctionName(R);
    Q.data("conditional",O);e(w,A);r.conditional[O]=a(w,Q,y,A);var J=d("<div></div>").attr("id",z);w.$description=J;w.$el=Q;var n=Q.length>1?Q.eq(0):Q;M.push({$el:Q,key:w.key,$description:J});if(w.description!=null&&typeof w.description=="function"){w.description(J,n,R,w)}else{if(m.description!=null&&typeof m.description=="function"){m.description(J,n,R,w)}else{n.parent().after(J)}}var N=d.extend(true,{},m.message);if(w.message){for(var u in N){d.extend(N[u],w.message[u])}}var C=j.convertMessage(N,R);w.message=N;r.description[R]=C}}function H(V){var W=V.isValidateField;if(W===undefined){for(var U in M){var S=M[U];var T=S.$el;if(T[0]===V[0]){W=true;V.ruleKey=S.key;break}}if(!W){W=false}V.isValidateField=W}return W}function P(){if(!m.hasSortElements){var S=[];v.find("input, select, textarea").each(function(V,Y){var U=d(Y);for(var X in M){var T=M[X];var W=T.$el;if(W[0]===U[0]){S.push(T);break}}});M=S;m.hasSortElements=true;m.$elements=M}}var x={eachInvalidField:r.eachInvalidField,eachValidField:r.eachValidField,invalid:r.invalid};r.eachInvalidField=function(){var S=x.eachInvalidField;var T=d(this);if(H(T)){T.data("validField",false);S.apply(this,arguments);if(m.always&&typeof m.always==="function"){m.always.call(this,T.ruleKey,false)}}};r.eachValidField=function(){var S=x.eachValidField;var T=d(this);if(H(T)){T.data("validField",true);S.apply(this,arguments);if(m.always&&typeof m.always==="function"){m.always.call(this,T.ruleKey,true)}}};r.invalid=function(U,S){var T=x.invalid;T.apply(this,arguments);o()};m.$elements=M;v.validate(r);v.on("reset",function(S){m.clearAll(M)});function l(V){P();var S=null;for(var U in M){var W=M[U];var T=W.$el;var X=false;if(V!=null){if(W.key===V){if(T.data("validField")===false){S=W}break}}else{if(T.data("validField")===false){X=true;S=W;break}}}return S}var o=function(U,Y,X){var S;var T=m.scrollToError;var W=true;if(U!==undefined){S=A[U].$el}else{if(T){var V=l();if(V!==null){S=V.$el;U=V.key;Y=T.offset;X=T.duration}else{W=false}}else{W=false}}if(W){if(typeof Y==="function"){Y=Y.call(S,U,A)}Y=parseFloat(Y)||0;X=parseFloat(X)||500;d("html, body").animate({scrollTop:S.offset().top+Y},X)}};var D={clearAll:function(){m.clearAll(M)},scrollTo:function(S,U,T){if(S&&A[S]){o(S,U,T)}else{if(m.debug){i.log("the scroll key "+S+" is not exist, so not to scroll")}}},scrollErrorTo:function(U){var T=m.scrollToError;if(T){if(U!=null){var S=l(U);if(S){o(U,T.offset,T.duration)}else{if(m.debug){i.log("the scroll key "+U+" is not error field, so not to scroll")}}}else{o()}}else{if(m.debug){i.log("has no scrollToError setting, not to scroll")}}},getRuleKeys:function(U){if(U){P();var V=[];var T=M;for(var S in T){V.push(T[S].key)}return V}return j.getKeys(A)},getRule:function(S){return A[S]},getField:function(S){var T=this.getRule(S);if(T){return T.$el}return null},debug:function(S){if(S){this.options=r;this.api=k;this.custom=m}else{var U=["options","custom","api"];for(var T in U){delete this[U[T]]}}m.debug=S}};D.debug(m.debug);return D}})(jQuery);